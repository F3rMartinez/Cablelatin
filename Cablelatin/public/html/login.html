<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cable Latín System - Login</title>
    
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        :root {
            --color-principal: #0d6efd;
            --color-principal-hover: #0b5ed7;
            --color-texto: #212529; /* Color de texto original (ahora usaremos más blanco) */
            --color-texto-secundario: #6c757d;
            --color-fondo-oscuro: rgba(0, 0, 0, 0.7);
            --color-panel: #ffffff;
            --color-borde: #dee2e6;
            --color-error: #dc3545;
            --color-exito: #198754;
        }

        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            color: var(--color-texto);

            /* --- Fondo animado (CORREGIDO) --- */
            background-image: url('../logo.jpeg'); 
            
            background-size: 110% 110%;
            background-position: center center;
            background-repeat: no-repeat;
            animation: backgroundZoomPan 30s infinite alternate ease-in-out;
            /* --- /Fondo animado --- */
        }

        /* Capa oscura sobre el fondo (MÁS CLARA AHORA) */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            /* MODIFICADO: De 0.6 a 0.4 para que el fondo se vea más */
            background-color: rgba(0, 0, 0, 0.4); 
            z-index: 0;
        }

        /* --- CONTENEDOR EFECTO VIDRIO (GLASSMORPHISM) --- */
        .container {
            /* MODIFICADO: Fondo transparente */
            background-color: rgba(255, 255, 255, 0.15);
            /* NUEVO: Efecto de desenfoque del fondo */
            backdrop-filter: blur(15px);
            
            padding: 2rem 2.5rem;
            border-radius: 0.75rem; /* Un poco más redondeado */
            
            /* MODIFICADO: Sombra más suave */
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
            
            /* NUEVO: Borde sutil para el efecto vidrio */
            border: 1px solid rgba(255, 255, 255, 0.2);

            width: 100%;
            max-width: 400px;
            text-align: center;
            
            /* ELIMINADO: Borde superior azul, ya no es necesario */
            /* border-top: 5px solid var(--color-principal); */
            
            z-index: 1; 
            position: relative; 
        }
        /* --- FIN CONTENEDOR EFECTO VIDRIO --- */


        .logo-icon {
            color: var(--color-principal);
            width: 50px;
            height: 50px;
            margin-bottom: 0.5rem;
        }

        .container h1 {
            /* MODIFICADO: Texto blanco para legibilidad */
            color: #ffffff; 
            font-size: 1.5rem;
            font-weight: 700;
            margin-top: 0;
            margin-bottom: 1.5rem;
        }

        #loginForm {
            display: flex;
            flex-direction: column;
            text-align: left;
        }

        #loginForm label {
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
            /* MODIFICADO: Texto blanco para legibilidad */
            color: #ffffff; 
        }

        #loginForm input {
            width: 100%;
            padding: 0.75rem;
            
            /* MODIFICADO: Borde y fondo para efecto vidrio */
            border: 1px solid rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff; /* Texto del input en blanco */
            
            border-radius: 0.375rem;
            box-sizing: border-box;
            margin-bottom: 1rem;
            font-size: 0.95rem;
        }
        
        /* NUEVO: Estilo para el placeholder */
        #loginForm input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        #loginForm input:focus {
            /* MODIFICADO: Foco blanco */
            border-color: #ffffff;
            box-shadow: 0 0 0 0.25rem rgba(255, 255, 255, 0.2);
            outline: none;
        }
        
        /* NUEVO: Estilo para inputs deshabilitados */
        #loginForm input:disabled {
            background: rgba(255, 255, 255, 0.05);
            cursor: not-allowed;
        }


        #loginBtn {
            background-color: var(--color-principal);
            color: white;
            border: none;
            padding: 0.85rem;
            border-radius: 0.375rem;
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-top: 0.5rem;
            display: flex;
            justify-content: center;
            align: items center;
            gap: 0.5rem;
        }

        #loginBtn:hover:not(:disabled) {
            background-color: var(--color-principal-hover);
        }

        #loginBtn:disabled {
            opacity: 0.7;
            cursor: wait;
        }

        .spinner {
            width: 18px;
            height: 18px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top-color: #ffffff;
            border-radius: 50%;
            animation: spin 1s ease-in-out infinite;
            display: none;
        }

        #loginBtn.loading .spinner {
            display: block;
        }
        
        #loginBtn.loading .btn-text {
            display: none;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        #msg-box {
            font-size: 0.9rem;
            margin-top: 1rem;
            color: var(--color-error);
            display: none;
            font-weight: 500; /* Un poco más grueso para leerse bien */
        }
        
        #msg-box.show {
            display: block;
        }

        #msg-box.success {
            color: var(--color-exito);
        }

        /* --- Animación de fondo (Adelante y atrás) --- */
        @keyframes backgroundZoomPan {
            0% {
                background-size: 110% 110%;
                background-position: 50% 50%;
            }
            25% {
                background-size: 115% 115%;
                background-position: 40% 60%;
            }
            50% {
                background-size: 120% 120%;
                background-position: 60% 40%;
            }
            75% {
                background-size: 115% 115%;
                background-position: 70% 50%;
            }
            100% {
                background-size: 110% 110%;
                background-position: 50% 50%;
            }
        }

        /* Media queries para pantallas pequeñas */
        @media (max-width: 500px) {
            .container {
                margin: 1rem;
                padding: 1.5rem;
                /* Asegurarse que el blur funcione en bordes */
                overflow: hidden; 
            }
            .logo-icon {
                width: 40px;
                height: 40px;
            }
            .container h1 {
                font-size: 1.3rem;
            }
        }

    </style>
</head>
<body>
    
    <div class="container">
        <i data-lucide="tv-2" class="logo-icon"></i>
        <h1>CABLE LATÍN</h1>

        <form id="loginForm">
            <label for="usuario">Usuario</label>
            <input type="text" id="usuario" placeholder="Ingresar su usuario" required>

            <label for="contraseña">Contraseña</label>
            <input type="password" id="contraseña" placeholder="Ingresar su contraseña" required>

            <button type="submit" id="loginBtn">
                <span class="spinner"></span>
                <span class="btn-text">INGRESAR</span>
            </button>
        </form>

        <p id="msg-box"></p>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();

            const loginForm = document.getElementById('loginForm');
            const loginBtn = document.getElementById('loginBtn');
            const btnText = loginBtn.querySelector('.btn-text');
            const usuarioInput = document.getElementById('usuario');
            const contraseñaInput = document.getElementById('contraseña');
            const msgBox = document.getElementById('msg-box');

            // --- NUEVAS VARIABLES PARA EL BLOQUEO ---
            let intentosFallidos = 0;
            const MAX_INTENTOS = 3;
            const SEGUNDOS_BLOQUEO = 30;
            let enBloqueo = false;
            // --- FIN NUEVAS VARIABLES ---


            loginForm.addEventListener('submit', (e) => {
                e.preventDefault();

                // Si está en bloqueo, no hacer nada
                if (enBloqueo) return;

                const usuario = usuarioInput.value.trim();
                const contraseña = contraseñaInput.value.trim();

                if (!usuario || !contraseña) {
                    mostrarMensaje('Por favor, ingrese usuario y contraseña.', 'error');
                    return;
                }

                setLoading(true);

                setTimeout(() => {
                    // Simulación:
                    if (usuario === 'admin' && contraseña === '12345') {
                        // --- ÉXITO ---
                        mostrarMensaje('¡Inicio de sesión exitoso!', 'success');
                        intentosFallidos = 0; // Resetea el contador
                        
                        setTimeout(() => {
                            window.location.href = 'dashboard.html';
                        }, 1000);

                    } else {
                        // --- ERROR ---
                        intentosFallidos++;
                        
                        if (intentosFallidos >= MAX_INTENTOS) {
                            // Alcanzó el límite, iniciar bloqueo
                            iniciarBloqueo();
                        } else {
                            // Mostrar error normal
                            const restantes = MAX_INTENTOS - intentosFallidos;
                            mostrarMensaje(`Datos incorrectos. Quedan ${restantes} ${restantes === 1 ? 'intento' : 'intentos'}.`, 'error');
                            setLoading(false); // Reactiva para el siguiente intento
                        }
                    }

                }, 1500); // Simulación de tiempo de respuesta
            });

            // --- NUEVA FUNCIÓN DE BLOQUEO ---
            function iniciarBloqueo() {
                enBloqueo = true;
                setLoading(false); // Quita el spinner de carga
                setFormDisabled(true); // Deshabilita inputs y botón

                let segundosRestantes = SEGUNDOS_BLOQUEO;
                
                // Muestra el primer mensaje del contador
                mostrarMensaje(`Demasiados intentos. Espere ${segundosRestantes} segundos.`, 'error');

                // Inicia el intervalo de la cuenta regresiva
                const timerInterval = setInterval(() => {
                    segundosRestantes--;
                    
                    if (segundosRestantes > 0) {
                        // Actualiza el contador
                        mostrarMensaje(`Demasiados intentos. Espere ${segundosRestantes} segundos.`, 'error');
                    } else {
                        // Se acabó el tiempo
                        clearInterval(timerInterval); // Detiene el intervalo
                        mostrarMensaje('Puede intentarlo de nuevo.', 'success'); // Mensaje positivo
                        
                        intentosFallidos = 0; // Resetea el contador
                        enBloqueo = false; // Libera el bloqueo
                        setFormDisabled(false); // Rehabilita el formulario
                        
                        // Opcional: oculta el mensaje de "puede intentarlo" después de 3 seg
                        setTimeout(() => {
                            if (!enBloqueo) { // Solo si no ha vuelto a fallar
                                msgBox.classList.remove('show');
                            }
                        }, 3000);
                    }
                }, 1000); // Cada segundo
            }

            function mostrarMensaje(mensaje, tipo = 'error') {
                msgBox.textContent = mensaje;
                msgBox.classList.add('show');
                
                if (tipo === 'success') {
                    msgBox.classList.add('success');
                    msgBox.classList.remove('error');
                } else {
                    msgBox.classList.add('error');
                    msgBox.classList.remove('success');
                }
            }

            // --- FUNCIÓN MODIFICADA ---
            // Ahora también deshabilita inputs al cargar
            function setLoading(isLoading) {
                if (isLoading) {
                    loginBtn.classList.add('loading');
                    btnText.textContent = 'INGRESANDO...';
                } else {
                    loginBtn.classList.remove('loading');
                    btnText.textContent = 'INGRESAR';
                }
                // Llama a la nueva función auxiliar
                setFormDisabled(isLoading);
            }

            // --- NUEVA FUNCIÓN AUXILIAR ---
            // Para habilitar/deshabilitar todo el formulario
            function setFormDisabled(disabled) {
                usuarioInput.disabled = disabled;
                contraseñaInput.disabled = disabled;
                loginBtn.disabled = disabled;
                
                // Cambia el cursor si está deshabilitado
                if (disabled) {
                    loginBtn.style.cursor = 'not-allowed';
                } else {
                    loginBtn.style.cursor = 'pointer';
                    // Restablece el estado de 'wait' si venía de setLoading
                    if (!loginBtn.classList.contains('loading')) {
                        loginBtn.style.cursor = 'pointer';
                    }
                }
            }
        });
    </script>
    </body>
</html>